# Implementation Plan: Jotain Baseline

**Branch**: `001-baseline` | **Date**: 2026-02-22 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-baseline/spec.md`

## Summary

Document and validate the current state of the Jotain modular Emacs
distribution. This baseline plan captures the existing architecture,
entities, interfaces, and test coverage so that future feature work
can be planned incrementally against a known-good foundation. No new
code is being written — the deliverables are specification artifacts
that formalise what already exists.

## Technical Context

**Language/Version**: Emacs Lisp (Emacs 30+, PGTK build), Nix (Flakes)
**Primary Dependencies**: use-package, Vertico, Corfu, Consult,
Orderless, Embark, Eglot, Magit, doom-themes, nord-theme, auto-dark,
org-mode, tree-sitter
**Storage**: N/A (configuration files only; no persistent data storage)
**Testing**: ERT (Emacs Regression Testing), NMT (Nix Module Tests),
nixosTest (VM-based runtime validation)
**Target Platform**: Linux (primary), macOS (secondary),
Android/Termux (mobile)
**Project Type**: Desktop application configuration / Nix Flake
distribution
**Performance Goals**: Standalone startup < 3s; daemon connection
< 1s; smoke tests < 1s; fast tests < 5s
**Constraints**: All packages via Nix (no runtime MELPA/ELPA);
Emacs 30+ required; flake-based builds only
**Scale/Scope**: 17 Elisp modules, ~3000 LOC (Elisp + Nix),
15 test files, 5 NMT test cases, single-user desktop application

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| # | Principle | Status | Evidence |
|---|-----------|--------|----------|
| I | Nix-Only Package Management | PASS | `use-package-always-ensure nil`; `package-archives` set to nil; `nix/lib/dependencies.nix` auto-extracts packages |
| II | Modular Elisp Architecture | PASS | 17 single-domain modules in `elisp/`; all use `lexical-binding: t`; `init.el` orchestrates load order |
| III | Reproducibility First | PASS | `flake.nix` + `flake.lock` committed; all deps in `runtime-deps.nix`; `TREE_SITTER_DIR` injected at build time |
| IV | Testing Discipline | PASS | ERT tests tagged (smoke/fast/unit/integration); NMT tests for all HM options; tests isolated via `.dev-home` |
| V | Platform Portability | PASS | `platform.el` provides constants and macros; platform-specific code guarded; graceful degradation implemented |
| VI | Performance by Design | PASS | `early-init.el` disables GUI early; font caching; idle GC timers; daemon default; Eglot JSON-RPC logging disabled |
| VII | Simplicity & YAGNI | PASS | No speculative options; HM module exposes 4 options only; no premature abstractions detected |

**Result**: All gates pass. Proceeding to Phase 0.

## Project Structure

### Documentation (this feature)

```text
specs/001-baseline/
├── plan.md              # This file
├── research.md          # Phase 0: Architecture validation findings
├── data-model.md        # Phase 1: Entity definitions and relationships
├── quickstart.md        # Phase 1: Getting started guide
└── tasks.md             # Phase 2: Generated by /speckit.tasks
```

### Source Code (repository root)

```text
elisp/                   # 17 Elisp configuration modules
├── core.el              # Base settings, keybindings, built-in modes
├── ui.el                # Theme system, visual enhancements
├── fonts.el             # Font selection, fallback chains, scaling
├── completion.el        # Vertico, Corfu, Consult, Orderless, Embark
├── programming.el       # Eglot, tree-sitter, Flymake, language modes
├── git.el               # Magit, diff-hl, worktrees
├── writing.el           # Org-mode, exporters, mixed-pitch fonts
├── dashboard.el         # Enlight startup screen
├── platform.el          # Platform detection constants and macros
├── platforms.el         # Platform-specific configurations
├── android.el           # Android/Termux optimizations
├── per-project.el       # Project management, compilation targets
├── help.el              # Enhanced help system, Dash docs
├── systems.el           # 1Password, logview, sops
├── collaboration.el     # Org-Jira integration
└── utils.el             # Shared utility functions

nix/
├── lib/
│   ├── dependencies.nix # Auto-extracts use-package → nixpkgs mapping
│   └── runtime-deps.nix # LSP servers, CLI tools, fonts, grammars
├── modules/
│   ├── home/default.nix # Home Manager module (primary interface)
│   └── nixos/default.nix# NixOS system module (supplementary)
├── overlays/default.nix # Package overlay (jotain, jotainEmacs)
└── checks/default.nix   # CI check definitions

tests/                   # ERT test suite (15 files)
├── test-smoke.el        # Ultra-fast smoke tests (<1s)
├── test-init-loads.el   # Configuration loading integration tests
├── test-platform.el     # Platform detection unit tests
├── test-completion.el   # Completion system tests
├── test-programming.el  # Programming tools tests
├── test-ui.el           # Theme system tests
├── test-runtime-deps.el # Runtime dependency availability tests
├── test-utils.el        # Utility function tests
├── test-use-package-ensure.el # Nix-only package model validation
├── test-auth-source-1password.el # 1Password integration tests
├── test-git-worktrees.el# Git worktree tests
├── test-helpers.el      # Shared test utilities
├── test-all.el          # Auto-discovery test loader
├── test-suite-fast.el   # Fast test runner
└── test-suite-smoke.el  # Smoke test runner

nmt-tests/               # Home Manager module integration tests
├── default.nix          # 5 NMT test cases
└── runtime.nix          # VM-based runtime validation

init.el                  # Main entry point (module loader)
early-init.el            # Pre-GUI optimization
emacs.nix                # Emacs build with packages + runtime deps
default.nix              # Jotain config package + test derivations
flake.nix                # Flake entry point (all outputs)
justfile                 # Task runner (test, build, dev commands)
```

**Structure Decision**: Jotain uses a flat Elisp module structure
under `elisp/` with a parallel Nix build system under `nix/`.
Tests are split between ERT (`tests/`) and NMT (`nmt-tests/`).
This matches the "single project" pattern adapted for an Emacs
distribution rather than a traditional application.

## Complexity Tracking

No constitution violations detected. Table intentionally empty.

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| (none)    | —          | —                                   |
